raindex-version: 8898591f3bcaa21dc91dc3b8584330fc405eadfa

networks:
  arbitrum:
    rpc: https://rpc.ankr.com/arbitrum
    chain-id: 42161
    network-id: 42161
    currency: ETH
  bsc:
    rpc: https://rpc.ankr.com/bsc
    chain-id: 56
    network-id: 56
    currency: BNB
  base:
    rpc: https://mainnet.base.org
    chain-id: 8453
    network-id: 8453
    currency: ETH
  ethereum:
    rpc: https://rpc.ankr.com/eth
    chain-id: 1
    network-id: 1
    currency: ETH
  flare:
    rpc: https://rpc.ankr.com/flare
    chain-id: 14
    network-id: 14
    currency: FLR

metaboards:
  arbitrum: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/mb-arbitrum/0.1/gn
  bsc: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/ob4-bsc/2024-10-14-63f4/gn
  base: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/mb-base/0.1/gn
  ethereum: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/metadata-mainnet/2024-10-25-2857/gn
  flare: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/mb-flare-0x893BBFB7/0.1/gn

subgraphs:
  arbitrum: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/ob4-arbitrum/0.1/gn
  bsc: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/ob4-bsc/0.1/gn
  base: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/ob4-base/0.1/gn
  ethereum: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/ob4-mainnet/2024-10-25-af6a/gn
  flare: https://api.goldsky.com/api/public/project_clv14x04y9kzi01saerx7bxpg/subgraphs/ob4-flare/0.2/gn

orderbooks:
  arbitrum:
    address: 0x550878091b2B1506069F61ae59e3A5484Bca9166
    network: arbitrum
    subgraph: arbitrum
  bsc:
    address: 0xd2938E7c9fe3597F78832CE780Feb61945c377d7
    network: bsc
    subgraph: bsc
  base:
    address: 0xd2938e7c9fe3597f78832ce780feb61945c377d7
    network: base
    subgraph: base
  ethereum:
    address: 0x0eA6d458488d1cf51695e1D6e4744e6FB715d37C
    network: ethereum
    subgraph: ethereum
  flare:
    address: 0xCEe8Cd002F151A536394E564b84076c41bBBcD4d

deployers:
  arbitrum:
    address: 0x9B0D254bd858208074De3d2DaF5af11b3D2F377F
    network: arbitrum
  bsc:
    address: 0xA2f56F8F74B7d04d61f281BE6576b6155581dcBA
    network: bsc
  base:
    address: 0xC1A14cE2fd58A3A2f99deCb8eDd866204eE07f8D
    network: base
  ethereum:
    address: 0xd19581a021f4704ad4eBfF68258e7A0a9DB1CD77
    network: ethereum
  flare:
    address: 0xE3989Ea7486c0F418C764e6c511e86f6E8830FAb

tokens:
  arbitrum-wbtc:
    network: arbitrum
    address: 0x2f2a2543B76A4166549F7aaB2e75Bef0aefC5B0f
    decimals: 8
  arbitrum-weth:
    network: arbitrum
    address: 0x82aF49447D8a07e3bd95BD0d56f35241523fBab1
    decimals: 18
  bsc-tft:
    network: bsc
    address: 0x8f0FB159380176D324542b3a7933F0C2Fd0c2bbf
    decimals: 7
  bsc-busd:
    network: bsc
    address: 0xe9e7CEA3DedcA5984780Bafc599bD69ADd087D56
    decimals: 18
  base-usdc:
    network: base
    address: 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
    decimals: 6
  base-paid:
    network: base
    address: 0x655A51e6803faF50D4acE80fa501af2F29C856cF
    decimals: 18
  ethereum-weth:
    network: ethereum
    address: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2
    decimals: 18
  ethereum-pai:
    network: ethereum
    address: 0x13E4b8CfFe704d3De6F19E52b201d92c21EC18bD
    decimals: 18
  ethereum-nmt:
    network: ethereum
    address: 0x03AA6298F1370642642415EDC0db8b957783e8D6
    decimals: 18
  ethereum-usdc:
    network: ethereum
    address: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48
    decimals: 6
  flare-wflr:
    network: flare
    address: 0x1D80c49BbBCd1C0911346656B529DF9E5c2F783d
    decimals: 18
  flare-sflr:
    network: flare
    address: 0x12e605bc104e93B45e1aD99F9e555f659051c2BB
    decimals: 18

orders:
  arbitrum-wbtc-weth:
    orderbook: arbitrum
    network: arbitrum
    inputs:
      - token: arbitrum-weth
    outputs:
      - token: arbitrum-wbtc
  bsc-tft-busd:
    orderbook: bsc
    network: bsc
    inputs:
      - token: bsc-tft
    outputs:
      - token: bsc-busd
  bsc-busd-tft:
    orderbook: bsc
    network: bsc
    inputs:
      - token: bsc-busd
    outputs:
      - token: bsc-tft
  base-usdc-paid:
    orderbook: base
    network: base
    inputs:
      - token: base-usdc
    outputs:
      - token: base-paid
  base-paid-usdc:
    orderbook: base
    network: base
    inputs:
      - token: base-paid
    outputs:
      - token: base-usdc
  ethereum-pai-weth:
    orderbook: ethereum
    network: ethereum
    inputs:
      - token: ethereum-weth
    outputs:
      - token: ethereum-pai
  ethereum-weth-pai:
    orderbook: ethereum
    network: ethereum
    inputs:
      - token: ethereum-pai
    outputs:
      - token: ethereum-weth
  ethereum-nmt-usdc:
    orderbook: ethereum
    network: ethereum
    inputs:
      - token: ethereum-nmt
    outputs:
      - token: ethereum-usdc
  ethereum-usdc-nmt:
    orderbook: ethereum
    network: ethereum
    inputs:
      - token: ethereum-usdc
    outputs:
      - token: ethereum-nmt
  flare-sflr-wflr:
    orderbook: flare
    network: flare
    inputs:
      - token: flare-sflr
    outputs:
      - token: flare-wflr

scenarios:
  arbitrum:
    orderbook: arbitrum
    runs: 1
    bindings:
      raindex-subparser: 0xb06202aA3Fe7d85171fB7aA5f17011d17E63f382
      baseline-fn: '''constant-baseline'
      initial-io-fn: '''constant-initial-io'
  bsc:
    orderbook: bsc
    runs: 1
    bindings:
      raindex-subparser: 0x662dFd6d5B6DF94E07A60954901D3001c24F856a
      baseline-fn: '''constant-baseline'
      initial-io-fn: '''constant-initial-io'
  base:
    orderbook: base
    runs: 1
    bindings:
      raindex-subparser: 0x662dFd6d5B6DF94E07A60954901D3001c24F856a
      baseline-fn: '''constant-baseline'
      initial-io-fn: '''constant-initial-io'
  ethereum:
    orderbook: ethereum
    runs: 1
    bindings:
      raindex-subparser: 0x22410e2a46261a1B1e3899a072f303022801C764
      baseline-fn: '''constant-baseline'
      initial-io-fn: '''constant-initial-io'
  flare-sflr-baseline:
    orderbook: flare
    deployer: flare
    runs: 1
    bindings:
      raindex-subparser: 0xFe2411CDa193D9E4e83A5c234C7Fd320101883aC
      baseline-fn: '''sflr-baseline'
      initial-io-fn: '''sflr-baseline'
      next-trade-baseline-multiplier: 0

deployments:
  arbitrum-wbtc-weth:
    order: arbitrum-wbtc-weth
    scenario: arbitrum
  bsc-tft-busd:
    order: bsc-tft-busd
    scenario: bsc
  bsc-busd-tft:
    order: bsc-busd-tft
    scenario: bsc
  base-usdc-paid:
    order: base-usdc-paid
    scenario: base
  base-paid-usdc:
    order: base-paid-usdc
    scenario: base
  ethereum-pai-weth:
    order: ethereum-pai-weth
    scenario: ethereum
  ethereum-weth-pai:
    order: ethereum-weth-pai
    scenario: ethereum
  ethereum-nmt-usdc:
    order: ethereum-nmt-usdc
    scenario: ethereum
  ethereum-usdc-nmt:
    order: ethereum-usdc-nmt
    scenario: ethereum
  flare-sflr-wflr:
    order: flare-sflr-wflr
    scenario: flare-sflr-baseline

gui:
  name: Auction based cost averaging
  description: >
    Swap some token for another token regularly over time, using a preset budget.

    This is called "cost averaging" because spreading out a single large swap
    into many smaller swaps over time reduces the impact of temporary market
    movements.

    The strategy works by repeatedly auctioning off tokens with an exponential
    decay in the price, that resets each trade.
  deployments:
    - deployment: arbitrum-wbtc-weth
      name: Sell WBTC for WETH on Arbitrum.
      description: >
        Participate in [the flippening](https://ultrasound.money/#flippening) by swapping WBTC for WETH on Arbitrum.
      deposits:
        - token: arbitrum-wbtc
          min: 0
          presets:
            - 0
            - 0.0001
            - 0.001
            - 0.01
            - 0.1
            - 0.2

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.


            For example, if the budget is daily then this is 86400 seconds (24 * 60 * 60).
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
            - name: Per 30 days (2592000)
              value: 2592000
            - name: Per 365 days (31536000)
              value: 31536000
        - binding: amount-per-epoch
          name: Budget (WBTC per period)
          description: >
            The amount of WBTC to spend each budget period.

            For example, if the budget is daily and this is 0.01 then 0.01 WBTC will be sold for WETH each day.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (WBTC)
          description: >
            The maximum amount of WBTC to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (WBTC)
          description: >
            The minimum amount of WBTC to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.

            As the auction is an exponential decay, the price will halve every time this period passes.

            For example, if the auction period is 1 hour then this is 3600 seconds (60 * 60).
            If this hourly auction starts at 30 WETH per WBTC, and the baseline is 10 WETH per WBTC,
            then the price will be 20 WETH per WBTC after 1 hour (halfway between 30 and 10),
            15 WETH per WBTC after 2 hours (halfway between 20 and 10),
            and so on.
          presets:
            - name: Every 20 minutes (1200)
              value: 1200
            - name: Every 30 minutes (1800)
              value: 1800
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
            - name: Every 3 hours (10800)
              value: 10800
            - name: Every 6 hours (21600)
              value: 21600
            - name: Every 12 hours (43200)
              value: 43200
            - name: Every 24 hours (86400)
              value: 86400
        - binding: baseline
          name: Baseline WETH per WBTC
          description: >
            The absolute minimum amount of WETH per WBTC that the auction will
            trade at.

            This is the inverse (i.e. `1 / x`) of the ETH/BTC ratio.

            For example, 20 WETH per WBTC would mean never selling WBTC when the
            ETH/BTC ratio is worse than 0.05.

            This can be set to 0 to disable the baseline.
          presets:
            - name: 10
              value: 10
            - name: 20
              value: 20
            - name: 25
              value: 25
            - name: 30
              value: 30
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.

            For example, if this is 1.1 and the last trade was at 20 WETH per WBTC,
            then the next auction will start at 22 WETH per WBTC.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
            - name: 1.1x
              value: 1.1
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.

            For example, if this is 0.9 and the last trade was at 20 WETH per WBTC,
            then the next auction will end at 18 WETH per WBTC.

            Note that this moving baseline is ignored if it goes below the baseline.
            I.e. the absolute minimum baseline overrides this if necessary.

            This can be set to 0 to disable the moving baseline, and should be less than 1.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.7x
              value: 0.7
            - name: 0.8x
              value: 0.8
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
            - name: 0.99x
              value: 0.99
        - binding: initial-io
          name: Kickoff WETH per WBTC
          description: >
            The initial WETH per WBTC to kickoff the first auction.

            The strategy will pretend that a trade was made at this price before
            the first auction, so that everything else can be calculated from there.

            This is WETH per WBTC, so if the ETH/BTC ratio is 0.05 then this should be 20.

            You can set this much higher than the market rates to start the strategy
            off easily, for example you could set it at 50 if the market was around 20-25.

            There is no need for this to be exact, it just has to be ballpark and
            definitely higher than the market. Any number within 1-10x the real
            price should be fine.

            This should be greater than the baseline.
          min: 0
          presets:
            - name: 30
              value: 30
            - name: 50
              value: 50
            - name: 100
              value: 100

    - deployment: bsc-tft-busd
      name: Buy TFT with BUSD on BSC.
      description: >
        Swap BUSD for TFT on BSC.
      deposits:
        - token: bsc-busd
          min: 0
          presets:
            - 0
            - 100
            - 1000
            - 10000
            - 100000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.

            For example, if the budget is daily then this is 86400 seconds (24 * 60 * 60).
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
            - name: Per 30 days (2592000)
              value: 2592000
            - name: Per 365 days (31536000)
              value: 31536000
        - binding: amount-per-epoch
          name: Budget (BUSD per period)
          description: >
            The amount of BUSD to spend each budget period.

            For example, if the budget is daily and this is 1000 then 1000 BUSD will be spent buying TFT each day.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (BUSD)
          description: >
            The maximum amount of BUSD to spend in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (BUSD)
          description: >
            The minimum amount of BUSD to spend in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every 20 minutes (1200)
              value: 1200
            - name: Every 30 minutes (1800)
              value: 1800
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
            - name: Every 3 hours (10800)
              value: 10800
            - name: Every 6 hours (21600)
              value: 21600
            - name: Every 12 hours (43200)
              value: 43200
            - name: Every 24 hours (86400)
              value: 86400
        - binding: baseline
          name: Baseline TFT per BUSD
          description: >
            The absolute minimum amount of TFT per BUSD that the auction will trade at (e.g. 111.1358)
          presets:
            - name: 100
              value: 100
            - name: 50
              value: 50
            - name: 20
              value: 20
            - name: 10
              value: 10
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
            - name: 1.1x
              value: 1.1
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.7x
              value: 0.7
            - name: 0.8x
              value: 0.8
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
            - name: 0.99x
              value: 0.99
        - binding: initial-io
          name: Kickoff TFT per BUSD
          description: >
            The initial TFT per BUSD to kickoff the first auction.
          min: 80
          presets:
            - name: 80
              value: 80
            - name: 100
              value: 100
            - name: 120
              value: 120
            - name: 150
              value: 150

    - deployment: bsc-busd-tft
      name: Sell TFT for BUSD on BSC.
      description: >
        Swap TFT for BUSD on BSC.
      deposits:
        - token: bsc-tft
          min: 0
          presets:
            - 0
            - 10
            - 100
            - 1000
            - 10000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.

            For example, if the budget is daily then this is 86400 seconds (24 * 60 * 60).
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
            - name: Per 30 days (2592000)
              value: 2592000
            - name: Per 365 days (31536000)
              value: 31536000
        - binding: amount-per-epoch
          name: Budget (TFT per period)
          description: >
            The amount of TFT to spend each budget period.

            For example, if the budget is daily and this is 100 then 100 TFT will be sold for BUSD each day.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (TFT)
          description: >
            The maximum amount of TFT to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (TFT)
          description: >
            The minimum amount of TFT to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every 20 minutes (1200)
              value: 1200
            - name: Every 30 minutes (1800)
              value: 1800
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
            - name: Every 3 hours (10800)
              value: 10800
            - name: Every 6 hours (21600)
              value: 21600
            - name: Every 12 hours (43200)
              value: 43200
            - name: Every 24 hours (86400)
              value: 86400
        - binding: baseline
          name: Baseline BUSD per TFT
          description: >
            The absolute minimum amount of BUSD per TFT that the auction will trade at (e.g. 0.007 BUSD per TFT).
          presets:
            - name: 5
              value: 5
            - name: 10
              value: 10
            - name: 20
              value: 20
            - name: 50
              value: 50
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
            - name: 1.1x
              value: 1.1
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.7x
              value: 0.7
            - name: 0.8x
              value: 0.8
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
            - name: 0.99x
              value: 0.99
        - binding: initial-io
          name: Kickoff BUSD per TFT
          description: >
            The initial BUSD per TFT to kickoff the first auction (e.g. 0.009 BUSD per TFT)
          min: 0
          presets:
            - name: 10
              value: 10
            - name: 20
              value: 20
            - name: 50
              value: 50

    - deployment: base-usdc-paid
      name: Sell PAID for USDC on Base.
      description: >
        Sell PAID for USDC on Base.
      deposits:
        - token: base-paid
          min: 0
          presets:
            - 0
            - 100
            - 1000
            - 10000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (PAID per period)
          description: >
            The amount of PAID to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (PAID)
          description: >
            The maximum amount of PAID to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (PAID)
          description: >
            The minimum amount of PAID to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
            - name: Every 4 hours (14400)
              value: 14400
        - binding: baseline
          name: Baseline USDC per PAID
          description: >
            The absolute minimum amount of USDC per PAID that the auction will trade at (e.g. 0.03 USDC per PAID)
          min: 0
          presets:
            - name: 0.01
              value: 0.01
            - name: 0.02
              value: 0.02
            - name: 0.05
              value: 0.05
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
        - binding: initial-io
          name: Kickoff USDC per PAID
          description: >
            The initial USDC per PAID to kickoff the first auction (e.g. 0.05 USDC per PAID)
          min: 0
          presets:
            - name: 0.05
              value: 0.05
            - name: 0.1
              value: 0.1

    - deployment: base-paid-usdc
      name: Buy PAID with USDC on Base.
      description: >
        Buy PAID with USDC on Base.
      deposits:
        - token: base-usdc
          min: 0
          presets:
            - 0
            - 100
            - 1000
            - 10000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (USDC per period)
          description: >
            The amount of USDC to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (USDC)
          description: >
            The maximum amount of USDC to spend in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (USDC)
          description: >
            The minimum amount of USDC to spend in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
            - name: Every 4 hours (14400)
              value: 14400
        - binding: baseline
          name: Baseline PAID per USDC
          description: >
            The absolute minimum amount of PAID per USDC that the auction will trade at (e.g. 10 PAID per USDC)
          min: 0
          presets:
            - name: 10
              value: 10
            - name: 20
              value: 20
            - name: 50
              value: 50
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
        - binding: initial-io
          name: Kickoff PAID per USDC
          description: >
            The initial PAID per USDC to kickoff the first auction (e.g. 20 PAID per USDC)
          min: 0
          presets:
            - name: 20
              value: 20
            - name: 50
              value: 50

    - deployment: ethereum-pai-weth
      name: Sell PAI for WETH on Ethereum.
      description: >
        Swap PAI for WETH on Ethereum mainnet.
      deposits:
        - token: ethereum-pai
          min: 0
          presets:
            - 0
            - 100
            - 500
            - 1000
            - 5000
            - 10000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (PAI per period)
          description: >
            The amount of PAI to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (PAI)
          description: >
            The maximum amount of PAI to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (PAI)
          description: >
            The minimum amount of PAI to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
        - binding: baseline
          name: Baseline WETH per PAI
          description: >
            The absolute minimum amount of WETH per PAI that the auction will trade at. (e.g. 0.0001 WETH per PAI)
          min: 0
          presets:
            - name: 0.0001
              value: 0.0001
            - name: 0.0005
              value: 0.0005
            - name: 0.001
              value: 0.001
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
        - binding: initial-io
          name: Kickoff WETH per PAI
          description: >
            The initial WETH per PAI to kickoff the first auction. (e.g. 0.00015 WETH per PAI)
          min: 0
          presets:
            - name: 0.001
              value: 0.001
            - name: 0.002
              value: 0.002
            - name: 0.005
              value: 0.005

    - deployment: ethereum-weth-pai
      name: Sell WETH for PAI on Ethereum.
      description: >
        Swap WETH for PAI on Ethereum mainnet.
      deposits:
        - token: ethereum-weth
          min: 0
          presets:
            - 0
            - 0.1
            - 0.5
            - 1
            - 2
            - 5

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (WETH per period)
          description: >
            The amount of WETH to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (WETH)
          description: >
            The maximum amount of WETH to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (WETH)
          description: >
            The minimum amount of WETH to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
        - binding: baseline
          name: Baseline PAI per WETH
          description: >
            The absolute minimum amount of PAI per WETH that the auction will trade at. (e.g. 5000 PAI per WETH)
          min: 0
          presets:
            - name: 500
              value: 500
            - name: 1000
              value: 1000
            - name: 2000
              value: 2000
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
        - binding: initial-io
          name: Kickoff PAI per WETH
          description: >
            The initial PAI per WETH to kickoff the first auction. (e.g. 6500 PAI per WETH)
          min: 0
          presets:
            - name: 1000
              value: 1000
            - name: 2000
              value: 2000
            - name: 5000
              value: 5000

    - deployment: ethereum-usdc-nmt
      name: Sell NMT for USDC on Ethereum.
      description: >
        Swap NMT for USDC on Ethereum mainnet.
      deposits:
        - token: ethereum-nmt
          min: 0
          presets:
            - 0
            - 100
            - 500
            - 1000
            - 5000
            - 10000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (NMT per period)
          description: >
            The amount of NMT to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (NMT)
          description: >
            The maximum amount of NMT to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (NMT)
          description: >
            The minimum amount of NMT to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
        - binding: baseline
          name: Baseline USDC per NMT
          description: >
            The absolute minimum amount of USDC per NMT that the auction will trade at. (e.g. 2 USDC per NMT)
          min: 0
          presets:
            - name: 1.75
              value: 1.75
            - name: 2
              value: 2
            - name: 2.25
              value: 2.25
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
        - binding: initial-io
          name: Kickoff USDC per NMT
          description: >
            The initial USDC per NMT to kickoff the first auction. (e.g. 9 USDC per NMT)
          min: 0
          presets:
            - name: 4
              value: 4
            - name: 6
              value: 6
            - name: 9
              value: 9

    - deployment: ethereum-nmt-usdc
      name: Sell USDC for NMT on Ethereum.
      description: >
        Swap USDC for NMT on Ethereum mainnet.
      deposits:
        - token: ethereum-usdc
          min: 0
          presets:
            - 0
            - 100
            - 200
            - 500
            - 1000
            - 2000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (USDC per period)
          description: >
            The amount of USDC to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (USDC)
          description: >
            The maximum amount of USDC to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (USDC)
          description: >
            The minimum amount of USDC to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
        - binding: baseline
          name: Baseline NMT per USDC
          description: >
            The absolute minimum amount of NMT per USDC that the auction will trade at. (e.g. 0.4 NMT per USDC)
          min: 0
          presets:
            - name: 0.35
              value: 0.35
            - name: 0.4
              value: 0.4
            - name: 0.45
              value: 0.45
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05
        - binding: next-trade-baseline-multiplier
          name: Auction end multiplier
          description: >
            The multiplier to apply to the last trade to set the baseline for the next auction.
          presets:
            - name: Disabled (0)
              value: 0
            - name: 0.9x
              value: 0.9
            - name: 0.95x
              value: 0.95
        - binding: initial-io
          name: Kickoff NMT per USDC
          description: >
            The initial NMT per USDC to kickoff the first auction. (e.g. 0.9 NMT per USDC)
          min: 0
          presets:
            - name: 0.8
              value: 0.8
            - name: 1.2
              value: 1.2
            - name: 1.5
              value: 1.5

    - deployment: flare-sflr-wflr
      name: Sell WFLR for SFLR on Flare based on underlying collateral.
      description: >
        Swap WFLR for SFLR on Flare based on underlying collateral.
      deposits:
        - token: flare-wflr
          min: 0
          presets:
            - 0
            - 100
            - 200
            - 500
            - 1000
            - 2000

      fields:
        - binding: time-per-amount-epoch
          name: Budget period (in seconds)
          description: >
            The budget is spent over this time period.
          min: 1
          presets:
            - name: Per minute (60)
              value: 60
            - name: Per hour (3600)
              value: 3600
            - name: Per day (86400)
              value: 86400
            - name: Per week (604800)
              value: 604800
        - binding: amount-per-epoch
          name: Budget (WFLR per period)
          description: >
            The amount of WFLR to spend each budget period.
          min: 0
        - binding: max-trade-amount
          name: Maximum trade size (WFLR)
          description: >
            The maximum amount of WFLR to sell in a single auction.
          min: 0
        - binding: min-trade-amount
          name: Minimum trade size (WFLR)
          description: >
            The minimum amount of WFLR to sell in a single auction.
          min: 0
        - binding: time-per-trade-epoch
          name: Auction period (in seconds)
          description: >
            The auction period is the time between each auction price halvening.
          presets:
            - name: Every hour (3600)
              value: 3600
            - name: Every 2 hours (7200)
              value: 7200
        - binding: next-trade-multiplier
          name: Auction start multiplier
          description: >
            The multiplier to apply to the last trade to kick off the next auction.
          min: 1.01
          presets:
            - name: 1.01x
              value: 1.01
            - name: 1.02x
              value: 1.02
            - name: 1.05x
              value: 1.05

---
#raindex-subparser !Raindex subparser.

#time-per-amount-epoch !Duration of one unit of streaming amount halflife.
#amount-per-epoch !Amount of output token to approve for buying per epoch.
#min-trade-amount !Each trade must be at least this many output tokens.
#max-trade-amount !Each trade will be capped at this many tokens.

#time-per-trade-epoch !Duration of one unit of io ratio halflife.
#baseline !Minimum io ratio. This component of the io ratio is ignored by the halflife calculations.

#baseline-fn !Function to calculate the baseline for the next trade.

#next-trade-multiplier !Start next auction at this x the last trade.
#next-trade-baseline-multiplier !Lifts the baseline to here relative to the previous trade.

#initial-io-fn !Function to calculate the initial io ratio for the first trade.
#initial-io !Strat will be initialized with this as the starting last trade. Must be larger than baseline.

#last-trade-time-key "last-trade-time"
#last-trade-io-key "last-trade-io"
#initial-time-key "initial-time"
#amount-used-key "amount-used"

#set-last-trade
last-io:,
:set(hash(order-hash() last-trade-time-key) now()),
:set(hash(order-hash() last-trade-io-key) last-io);

#set-initial-time
:set(hash(order-hash() initial-time-key) now());

#get-initial-time
_:get(hash(order-hash() initial-time-key));

#get-last-trade
last-time:get(hash(order-hash() last-trade-time-key)),
last-io:get(hash(order-hash() last-trade-io-key));

#get-epoch
initial-time: call<'get-initial-time>(),
last-time _: call<'get-last-trade>(),
duration: sub(now() any(last-time initial-time)),
total-duration: sub(now() initial-time),
ratio-freeze-epochs: div(min-trade-amount amount-per-epoch),
amount-epochs: div(total-duration time-per-amount-epoch),
trade-epochs: saturating-sub(div(duration time-per-trade-epoch) ratio-freeze-epochs);

#amount-for-epoch
amount-epochs:,
total-available: linear-growth(0 amount-per-epoch amount-epochs),
used: get(hash(order-hash() amount-used-key)),
unused: sub(total-available used),
capped-unused: min(unused max-trade-amount);

#halflife
max-val epoch:,
/**
 * Shrinking the multiplier like this
 * then applying it 10 times allows for
 * better precision when max-io-ratio
 * is very large, e.g. ~1e10 or ~1e20+
 *
 * This works because `power` loses
 * precision on base `0.5` when the
 * exponent is large and can even go
 * to `0` while the io-ratio is still
 * large. Better to keep the multiplier
 * higher precision and drop the io-ratio
 * smoothly for as long as we can.
 */
multiplier:
  power(0.5 div(epoch 10)),
val:
  mul(
    max-val
    multiplier
    multiplier
    multiplier
    multiplier
    multiplier
    multiplier
    multiplier
    multiplier
    multiplier
    multiplier
  );

#io-for-epoch
epoch:,
last-io: call<'get-last-trade>(),
max-next-trade: any(mul(last-io next-trade-multiplier) call<'initial-io-fn>()),
baseline-next-trade: mul(last-io next-trade-baseline-multiplier),
real-baseline: max(baseline-next-trade call<'baseline-fn>()),
variable-component: saturating-sub(max-next-trade real-baseline),
above-baseline: call<'halflife>(variable-component epoch),
_: add(real-baseline above-baseline);

#constant-initial-io
_: initial-io;

#constant-baseline
_: baseline;

#sflr-baseline
_: sflr-exchange-rate();

#handle-add-order
using-words-from raindex-subparser
:call<'set-initial-time>();

#calculate-io
using-words-from raindex-subparser
amount-epochs
trade-epochs:call<'get-epoch>(),
max-output: call<'amount-for-epoch>(amount-epochs),
io: call<'io-for-epoch>(trade-epochs),
:call<'set-last-trade>(io);

#handle-io
:ensure(greater-than-or-equal-to(output-vault-decrease() min-trade-amount) "Min trade amount."),
used: get(hash(order-hash() amount-used-key)),
:set(hash(order-hash() amount-used-key) add(used output-vault-decrease()));